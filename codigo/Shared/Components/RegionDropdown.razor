@namespace TruequeTextil.Shared.Components

<div class="dropdown">
    <button type="button"
            class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            disabled="@(IsLoading || Regiones.Count == 0)">
        @if (IsLoading)
        {
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            <span>Cargando...</span>
        }
        else if (SelectedRegionId == 0)
        {
            <span class="text-secondary">Selecciona una region...</span>
        }
        else
        {
            <span>@GetSelectedRegionName()</span>
        }
    </button>
    <ul class="dropdown-menu w-100" style="max-height: 300px; overflow-y: auto;">
        <li>
            <button type="button" class="dropdown-item text-secondary" @onclick="() => SelectRegion(0)">
                Selecciona una region...
            </button>
        </li>
        @foreach (var region in Regiones)
        {
            <li>
                <button type="button"
                        class="dropdown-item d-flex justify-content-between align-items-center @(SelectedRegionId == region.RegionId ? "active" : "")"
                        @onclick="() => SelectRegion(region.RegionId)">
                    <span>@region.NombreRegion</span>
                    @if (SelectedRegionId == region.RegionId)
                    {
                        <i class="bi bi-check"></i>
                    }
                </button>
            </li>
        }
    </ul>
</div>

@code {
    private string GetSelectedRegionName()
    {
        var region = Regiones.FirstOrDefault(r => r.RegionId == SelectedRegionId);
        return region?.NombreRegion ?? "Selecciona una region...";
    }

    private async void SelectRegion(int regionId)
    {
        SelectedRegionId = regionId;
        await SelectedRegionIdChanged.InvokeAsync(regionId);
    }
}
