@namespace TruequeTextil.Shared.Components

<div class="dropdown">
    <button type="button"
            class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            disabled="@(IsLoading || Comunas.Count == 0)">
        @if (IsLoading)
        {
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            <span>Cargando...</span>
        }
        else if (SelectedComunaId == 0)
        {
            <span class="text-secondary">Selecciona una comuna...</span>
        }
        else
        {
            <span>@GetSelectedComunaName()</span>
        }
    </button>
    <ul class="dropdown-menu w-100" style="max-height: 300px; overflow-y: auto;">
        <li>
            <button type="button" class="dropdown-item text-secondary" @onclick="() => SelectComuna(0)">
                Selecciona una comuna...
            </button>
        </li>
        @foreach (var comuna in Comunas)
        {
            <li>
                <button type="button"
                        class="dropdown-item d-flex justify-content-between align-items-center @(SelectedComunaId == comuna.ComunaId ? "active" : "")"
                        @onclick="() => SelectComuna(comuna.ComunaId)">
                    <span>@comuna.NombreComuna</span>
                    @if (SelectedComunaId == comuna.ComunaId)
                    {
                        <i class="bi bi-check"></i>
                    }
                </button>
            </li>
        }
    </ul>
</div>

@code {
    private string GetSelectedComunaName()
    {
        var comuna = Comunas.FirstOrDefault(c => c.ComunaId == SelectedComunaId);
        return comuna?.NombreComuna ?? "Selecciona una comuna...";
    }

    private async void SelectComuna(int comunaId)
    {
        SelectedComunaId = comunaId;
        await SelectedComunaIdChanged.InvokeAsync(comunaId);
    }
}
